{
  "info": {
    "name": "Markt New Endpoints - Search, Payments & Role Switch",
    "_postman_id": "a1b2c3d4-5e6f-7a8b-9c0d-1e2f3a4b5c6d",
    "description": "Collection for the new unified search endpoint, enhanced payment processing (including bank transfer), and role switching functionality.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Unified Search",
      "description": "Search across products, posts, and sellers in a single request",
      "item": [
        {
          "name": "Global Search - All Types",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Search succeeded\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const data = pm.response.json();",
                  "pm.test(\"Response contains all result types\", function () {",
                  "    pm.expect(data).to.have.property('products');",
                  "    pm.expect(data).to.have.property('posts');",
                  "    pm.expect(data).to.have.property('sellers');",
                  "    pm.expect(data).to.have.property('page');",
                  "    pm.expect(data).to.have.property('per_page');",
                  "});",
                  "",
                  "pm.test(\"Results are arrays\", function () {",
                  "    pm.expect(data.products).to.be.an('array');",
                  "    pm.expect(data.posts).to.be.an('array');",
                  "    pm.expect(data.sellers).to.be.an('array');",
                  "});",
                  "",
                  "console.log(`Found ${data.products.length} products, ${data.posts.length} posts, ${data.sellers.length} sellers`);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/search?search={{searchTerm}}&page={{page}}&per_page={{perPage}}",
              "host": ["{{baseUrl}}"],
              "path": ["search"],
              "query": [
                {
                  "key": "search",
                  "value": "{{searchTerm}}",
                  "description": "Search term to query across products, posts, and sellers"
                },
                {
                  "key": "page",
                  "value": "{{page}}",
                  "description": "Page number (default: 1)"
                },
                {
                  "key": "per_page",
                  "value": "{{perPage}}",
                  "description": "Items per page (default: 20)"
                }
              ]
            },
            "description": "Unified search endpoint that returns products, posts, and sellers matching the search term, along with pagination info. All results are returned in a single response object."
          }
        },
        {
          "name": "Global Search - Empty Query",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Empty search returns empty arrays\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    const data = pm.response.json();",
                  "    pm.expect(data.products).to.be.an('array');",
                  "    pm.expect(data.posts).to.be.an('array');",
                  "    pm.expect(data.sellers).to.be.an('array');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/search?page=1&per_page=20",
              "host": ["{{baseUrl}}"],
              "path": ["search"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "per_page",
                  "value": "20"
                }
              ]
            },
            "description": "Test the search endpoint without a search term. Should return empty arrays for all result types."
          }
        }
      ]
    },
    {
      "name": "Payment Processing",
      "description": "Payment endpoints with support for both card and bank transfer methods",
      "item": [
        {
          "name": "Create Payment - Card",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Payment created\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "const data = pm.response.json();",
                  "pm.collectionVariables.set(\"paymentId\", data.id);",
                  "pm.collectionVariables.set(\"paymentStatus\", data.status);",
                  "pm.collectionVariables.set(\"paymentMethod\", data.method);",
                  "",
                  "pm.test(\"Payment method is card\", function () {",
                  "    pm.expect(data.method).to.equal('card');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"order_id\": \"{{orderId}}\",\n    \"amount\": {{paymentAmount}},\n    \"currency\": \"NGN\",\n    \"method\": \"card\",\n    \"metadata\": {\n        \"customer_note\": \"Payment via card\"\n    }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/payments/create",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "create"]
            },
            "description": "Creates a payment record for card payment. Requires an existing order_id. The payment will be initialized with Paystack for card transactions."
          }
        },
        {
          "name": "Create Payment - Bank Transfer",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Bank transfer payment created\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "const data = pm.response.json();",
                  "pm.collectionVariables.set(\"bankPaymentId\", data.id);",
                  "pm.collectionVariables.set(\"bankPaymentStatus\", data.status);",
                  "",
                  "pm.test(\"Payment method is bank_transfer\", function () {",
                  "    pm.expect(data.method).to.equal('bank_transfer');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"order_id\": \"{{orderId}}\",\n    \"amount\": {{paymentAmount}},\n    \"currency\": \"NGN\",\n    \"method\": \"bank_transfer\",\n    \"metadata\": {\n        \"customer_note\": \"Payment via bank transfer\"\n    }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/payments/create",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "create"]
            },
            "description": "Creates a payment record for bank transfer. The payment will be processed using Paystack's Charge API when you call the process endpoint with bank details."
          }
        },
        {
          "name": "Process Payment - Card (with Authorization Code)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Payment processed\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const data = pm.response.json();",
                  "pm.collectionVariables.set(\"paymentStatus\", data.status);",
                  "",
                  "pm.test(\"Payment status updated\", function () {",
                  "    pm.expect(['completed', 'pending', 'failed']).to.include(data.status);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"authorization_code\": \"{{authorizationCode}}\",\n    \"metadata\": {\n        \"device\": \"mobile\",\n        \"ip_address\": \"192.168.1.1\"\n    }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/payments/{{paymentId}}/process",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "{{paymentId}}", "process"]
            },
            "description": "Processes a card payment using a saved authorization code. The authorization_code should be obtained from a previous Paystack transaction or card save operation."
          }
        },
        {
          "name": "Process Payment - Bank Transfer",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Bank transfer initiated\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const data = pm.response.json();",
                  "pm.collectionVariables.set(\"bankPaymentStatus\", data.status);",
                  "",
                  "pm.test(\"Payment is pending (awaiting webhook)\", function () {",
                  "    // Bank transfers typically start as pending until webhook confirms",
                  "    pm.expect(['pending', 'completed']).to.include(data.status);",
                  "});",
                  "",
                  "if (data.gateway_response && data.gateway_response.data) {",
                  "    console.log('Paystack response:', JSON.stringify(data.gateway_response.data, null, 2));",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"bank\": {\n        \"code\": \"057\",\n        \"account_number\": \"0000000000\"\n    },\n    \"metadata\": {\n        \"customer_note\": \"Bank transfer payment\"\n    }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/payments/{{bankPaymentId}}/process",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "{{bankPaymentId}}", "process"]
            },
            "description": "Processes a bank transfer payment using Paystack's Charge API. The 'bank' object should contain:\n- 'code': Bank code (e.g., '057' for Zenith Bank, '058' for GTBank)\n- 'account_number': Customer's bank account number\n\nNote: The payment will remain in 'pending' status until Paystack sends a webhook confirming the transfer. Use the verify endpoint to check status."
          }
        },
        {
          "name": "Verify Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Payment verification succeeded\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const data = pm.response.json();",
                  "pm.test(\"Response contains verification status\", function () {",
                  "    pm.expect(data).to.have.property('verified');",
                  "});",
                  "",
                  "if (data.verified) {",
                  "    console.log('Payment verified successfully');",
                  "    console.log('Amount:', data.amount);",
                  "} else {",
                  "    console.log('Payment not yet verified');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/payments/{{paymentId}}/verify",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "{{paymentId}}", "verify"]
            },
            "description": "Verifies the payment status with Paystack. Useful for checking bank transfer payments that may take time to process. Returns verification status and payment details."
          }
        },
        {
          "name": "Get Payment Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Payment details retrieved\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const data = pm.response.json();",
                  "pm.test(\"Payment contains required fields\", function () {",
                  "    pm.expect(data).to.have.property('id');",
                  "    pm.expect(data).to.have.property('order_id');",
                  "    pm.expect(data).to.have.property('amount');",
                  "    pm.expect(data).to.have.property('status');",
                  "    pm.expect(data).to.have.property('method');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/payments/{{paymentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "{{paymentId}}"]
            },
            "description": "Retrieves detailed information about a payment, including status, method, transaction ID, and gateway response."
          }
        },
        {
          "name": "List User Payments",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Payments list retrieved\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const data = pm.response.json();",
                  "pm.test(\"Response contains pagination\", function () {",
                  "    pm.expect(data).to.have.property('payments');",
                  "    pm.expect(data).to.have.property('total');",
                  "    pm.expect(data).to.have.property('page');",
                  "    pm.expect(data).to.have.property('per_page');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/payments?page={{page}}&per_page={{perPage}}",
              "host": ["{{baseUrl}}"],
              "path": ["payments"],
              "query": [
                {
                  "key": "page",
                  "value": "{{page}}",
                  "description": "Page number"
                },
                {
                  "key": "per_page",
                  "value": "{{perPage}}",
                  "description": "Items per page"
                }
              ]
            },
            "description": "Lists all payments for the authenticated user with pagination."
          }
        }
      ]
    },
    {
      "name": "Role Switching",
      "description": "Switch between buyer and seller roles for dual-account users",
      "item": [
        {
          "name": "Switch Role",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Role switch succeeded\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const data = pm.response.json();",
                  "pm.test(\"Response contains role information\", function () {",
                  "    pm.expect(data).to.have.property('success');",
                  "    pm.expect(data).to.have.property('previous_role');",
                  "    pm.expect(data).to.have.property('current_role');",
                  "    pm.expect(data).to.have.property('message');",
                  "    pm.expect(data).to.have.property('user');",
                  "});",
                  "",
                  "pm.test(\"Role actually switched\", function () {",
                  "    pm.expect(data.previous_role).to.not.equal(data.current_role);",
                  "    pm.expect(['buyer', 'seller']).to.include(data.current_role);",
                  "    pm.expect(['buyer', 'seller']).to.include(data.previous_role);",
                  "});",
                  "",
                  "pm.collectionVariables.set(\"currentRole\", data.current_role);",
                  "pm.collectionVariables.set(\"previousRole\", data.previous_role);",
                  "",
                  "console.log(`Switched from ${data.previous_role} to ${data.current_role}`);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/switch-role",
              "host": ["{{baseUrl}}"],
              "path": ["users", "switch-role"]
            },
            "description": "Switches the authenticated user's role between buyer and seller. Only works for users who have both account types. The role preference is cached in Redis and persists across sessions."
          }
        },
        {
          "name": "Get Current User Profile (Check Role)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Profile retrieved\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const data = pm.response.json();",
                  "pm.test(\"Profile contains current_role\", function () {",
                  "    pm.expect(data).to.have.property('current_role');",
                  "    pm.expect(['buyer', 'seller']).to.include(data.current_role);",
                  "});",
                  "",
                  "pm.collectionVariables.set(\"currentRole\", data.current_role);",
                  "",
                  "console.log(`Current role: ${data.current_role}`);",
                  "console.log(`Is buyer: ${data.is_buyer}, Is seller: ${data.is_seller}`);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/profile",
              "host": ["{{baseUrl}}"],
              "path": ["users", "profile"]
            },
            "description": "Retrieves the current user's profile, including the current_role field. Use this to verify the role after switching."
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8000/api/v1",
      "type": "string",
      "description": "Base URL for the API"
    },
    {
      "key": "searchTerm",
      "value": "shoes",
      "type": "string",
      "description": "Search term for unified search"
    },
    {
      "key": "page",
      "value": "1",
      "type": "string",
      "description": "Page number for pagination"
    },
    {
      "key": "perPage",
      "value": "20",
      "type": "string",
      "description": "Items per page"
    },
    {
      "key": "orderId",
      "value": "",
      "type": "string",
      "description": "Order ID for payment creation (set after creating an order)"
    },
    {
      "key": "paymentId",
      "value": "",
      "type": "string",
      "description": "Payment ID (set after creating a payment)"
    },
    {
      "key": "bankPaymentId",
      "value": "",
      "type": "string",
      "description": "Bank transfer payment ID (set after creating a bank transfer payment)"
    },
    {
      "key": "paymentAmount",
      "value": "5000",
      "type": "string",
      "description": "Payment amount in NGN (kobo will be calculated automatically)"
    },
    {
      "key": "authorizationCode",
      "value": "",
      "type": "string",
      "description": "Paystack authorization code for saved card payments"
    },
    {
      "key": "currentRole",
      "value": "buyer",
      "type": "string",
      "description": "Current user role (updated after role switch)"
    },
    {
      "key": "previousRole",
      "value": "",
      "type": "string",
      "description": "Previous user role (updated after role switch)"
    }
  ]
}






